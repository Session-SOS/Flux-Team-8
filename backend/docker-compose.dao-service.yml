# ============================================================
# Flux DAO Service â€” Docker Compose (service-specific)
#
# This compose file is for the DAO Service only.
# Each Flux microservice has its own docker-compose file.
#
# The DAO Service is an INTERNAL microservice:
# - NOT exposed outside the Docker network
# - Accessed by Goal Planner, Scheduler, Observer over flux-internal
# - Port 8000 is mapped to host for development/testing only
#
# Prerequisites:
#   - Docker Desktop running
#   - Supabase running locally (port 54322)
#
# Usage:
#   docker-compose -f docker-compose.dao-service.yml up -d
#   docker-compose -f docker-compose.dao-service.yml down
# ============================================================

services:
  flux-dao-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: flux-dao-service
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql+asyncpg://postgres:postgres@host.docker.internal:54322/postgres
      - SERVICE_API_KEYS=["goal-planner-key-abc","scheduler-key-def","observer-key-ghi"]
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - flux-internal

networks:
  flux-internal:
    driver: bridge
    name: flux-internal
